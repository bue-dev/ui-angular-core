<!--
  Copyright (C) 2018-present evan GmbH.

  This program is free software: you can redistribute it and/or modify it
  under the terms of the GNU Affero General Public License, version 3,
  as published by the Free Software Foundation.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
  See the GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not, see http://www.gnu.org/licenses/ or
  write to the Free Software Foundation, Inc., 51 Franklin Street,
  Fifth Floor, Boston, MA, 02110-1301 USA, or download the license from
  the following URL: https://evan.network/license/

  You can be released from the requirements of the GNU Affero General Public
  License by purchasing a commercial license.
  Buying such a license is mandatory as soon as you use this software or parts
  of it on other blockchains than evan.network.

  For more information, please contact evan GmbH at this address:
  https://evan.network/license/
-->

<!----------------------------------- claim user alias--------------------------------------------->
<ng-template #userAlias let-address="address">
  <ng-container *ngIf="address">
    <ng-container *ngIf="address === claimService.ensRootOwner">
      evan ({{ claimService.ensRootOwner }})
    </ng-container>
    <ng-container *ngIf="address !== claimService.ensRootOwner">
      {{ (addressbook[address]?.alias || addressbook[address]?.email) ? (addressbook[address]?.alias || addressbook[address]?.email) + ' (' + address + ')' : address }}
    </ng-container>
  </ng-container>
</ng-template>

<!----------------------------- claim alias multiline --------------------------------------------->
<ng-template #userAliasMulti let-address="address">
  <ng-container *ngIf="address">
    <ng-container *ngIf="address === claimService.ensRootOwner">
      <b>evan</b>
      <p>{{ claimService.ensRootOwner }}</p>
    </ng-container>
    <ng-container *ngIf="address !== claimService.ensRootOwner">
      <b>
        {{ addressbook[address]?.alias || addressbook[address]?.email || ('_angularcore.no-alias' | translate) }}
      </b>
      <p>
        {{ address }}
      </p>
    </ng-container>
  </ng-container>
</ng-template>

<!---------------------------------------- claim icon --------------------------------------------->
<ng-template #claimIcon let-claim="claim" let-mode="mode">
  <div class="claim-icon">
    <ion-spinner *ngIf="loadingClaims"></ion-spinner>
    <ng-container *ngIf="!loadingClaims">
      <svg *ngIf="!claim.icon" version="1.0" xmlns="http://www.w3.org/2000/svg"
         width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000"
         preserveAspectRatio="xMidYMid meet">
          <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" stroke="none">
          <path d="M2510 4994 c-135 -140 -432 -395 -635 -547 -502 -375 -990 -618
          -1444 -719 l-104 -23 7 -107 c14 -233 92 -597 192 -894 311 -930 933 -1793
          1784 -2475 164 -131 188 -149 198 -149 20 0 283 183 420 293 594 475 1057
          1046 1388 1712 233 468 377 929 453 1450 12 77 21 147 21 156 0 11 -34 29
          -112 58 -335 126 -816 354 -1103 522 -374 219 -660 429 -906 667 -59 56 -108
          102 -111 102 -2 0 -24 -21 -48 -46z m143 -406 c392 -340 1056 -731 1682 -988
          72 -30 133 -56 137 -59 9 -7 -39 -250 -82 -421 -141 -556 -410 -1114 -770
          -1595 -149 -199 -270 -337 -474 -540 -200 -200 -320 -306 -491 -434 -144 -108
          -115 -109 -248 2 -422 354 -786 755 -1063 1172 -301 452 -517 931 -632 1405
          -33 135 -74 361 -67 368 2 3 69 26 147 52 466 156 946 432 1439 826 63 51 163
          135 223 188 59 53 109 96 112 96 2 0 41 -32 87 -72z"/>
          <path d="M2555 4460 c-11 -17 -256 -219 -395 -324 -411 -312 -848 -557 -1240
          -697 l-105 -37 2 -45 c2 -66 66 -317 127 -501 258 -773 756 -1489 1469 -2114
          l118 -104 37 28 c209 159 518 451 698 659 421 487 719 1003 908 1577 53 162
          126 451 129 509 l2 41 -110 47 c-609 263 -1145 578 -1582 930 -29 24 -54 37
          -58 31z"/>
        </g>
      </svg>

      <img
        *ngIf="claim.icon"
        [src]="_DomSanitizer.bypassSecurityTrustUrl(claim.icon)">
    </ng-container>
  </div>
</ng-template>

<!---------------------------------------- claim display ------------------------------------------>
<ng-template #claimDisplay let-claim="claim" let-mode="mode" let-action="action">
  <div [class]="'evan-claim mode-' + mode + ' status-' + claim.status"
    [title]="claim.displayName + ' (' + claim.name + ') '"
    (click)="action ? action($event) : openClaimPopup(claim, $event)">
    <ng-container *ngTemplateOutlet="claimIcon;context:{ claim: claim, mode: mode }"></ng-container>
    <ng-container *ngIf="!loadingClaims && mode != 'icon'">
      <div class="claim-label">
        <b *ngIf="!claim.creationDate">
          {{ claim.displayName }}
        </b>
        <div *ngIf="claim.creationDate">
          <b>{{ claim.displayName }}</b>
          <p>
            {{ claim.creationDate | date:'mediumDate':'':translate.translate.currentLang }}

            <ng-container *ngIf="claim.expirationDate">
              - {{ claim.expirationDate | date:'mediumDate':'':translate.translate.currentLang }}
            </ng-container>
          </p>
        </div>
      </div>

      <div class="claim-count" *ngIf="claim.claims && claim.claims.length > 1">
        {{ claim.claims.length }} <ion-icon name="people"></ion-icon>
        <ion-spinner *ngIf="claim.loading"></ion-spinner>
      </div>
    </ng-container>
  </div>
</ng-template>

<ng-template #claimPersonDisplay let-claim="claim" let-mode="mode">
  <div class="evan-person-claim">
    <div class="claim-person-icon">
      <ion-icon class="display-flex-justify" name="person"></ion-icon>
    </div>
    <div [class]="'evan-claim mode-' + mode + ' status-' + claim.status"
         [title]="getAddressbookName(claim.subjects ? claim.subjects[0] : claim.subject)">
      <div class="claim-label">
        <div>
          <ng-container *ngTemplateOutlet="userAliasMulti;context:{ address:claim.subjects ? claim.subjects[0] : claim.subject }"></ng-container>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #claimDetailHover let-node="node">
  <div>
    <div class="header">
      <b>{{ node.data.displayName }}</b>
      <p>{{ node.data.name }}</p>

      <button ion-button round outline icon-only
        (click)="openDBCPEdit(node.data)"
        *ngIf="node.data.topLevelEnsOwner === activeAccount">
        <ion-icon name="create"></ion-icon>
      </button>
    </div>

    <div class="body">
      <ion-row>
        <ion-col col-md-6>
          <b>{{ '_angularcore.claims.status' | translate }}</b>
          <p [class]="'status-' + node.data.status">
            {{ ('_angularcore.claims.warnings.' + node.data.warnings[0]) | translate }}
          </p>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col col-md-6>
          <b>{{ '_angularcore.claims.trust-taker' | translate }}</b>
          <p [class]="trustTakerStatusClass(node.data)">
            <ng-container
              *ngTemplateOutlet="userAlias;context:{ address: node.data.subjects ? node.data.subjects[0] : node.data.subject }">
            </ng-container>
          </p>
        </ion-col>
        <ion-col col-md-6>
          <b>{{ '_angularcore.claims.trust-provider' | translate }}</b>
          <p
            *ngIf="node.data.issuerAccount"
            [class]="trustProviderStatusClass(node.data)">
            <ng-container
              *ngTemplateOutlet="userAlias;context:{ address: node.data.issuerAccount }">
            </ng-container>
          </p>
          <p *ngIf="!node.data.issuerAccount">---</p>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col col-12>
          <b>{{ '_angularcore.claims.creation-date' | translate }}</b>
          <p>
            <ng-container *ngIf="node.data.creationDate">
              {{ node.data.creationDate | date:'mediumDate':'':translate.translate.currentLang }}
            </ng-container>
            <ng-container *ngIf="!node.data.creationDate">
              ---
            </ng-container>
          </p>
        </ion-col>
        <ion-col col-12 *ngIf="node.data.expirationDate">
          <b>{{ '_angularcore.claims.expiration-date' | translate }}</b>
          <p [class]="node.data.warnings.indexOf('expired') === -1 ? 'status-1' : 'status--1'">
            {{ node.data.expirationDate | date:'mediumDate':'':translate.translate.currentLang }}
          </p>
        </ion-col>
      </ion-row>
      <ion-row class="rejected" *ngIf="node.data.rejectReason">
        <ion-col col-12 *ngIf="node.data.rejectReason.rejector">
          <b>{{ '_angularcore.claims.rejector' | translate }}</b>
          <p class="status--1">
            <ng-container
              *ngTemplateOutlet="userAlias;context:{ address: node.data.rejectReason.rejector }">
            </ng-container>
          </p>
        </ion-col>
        <ion-col col-12>
          <b>{{ '_angularcore.claims.reject-date' | translate }}</b>
          <p>
            {{ node.data.rejectReason.date | date:'mediumDate':'':translate.translate.currentLang }}
          </p>
        </ion-col>
        <ion-col col-12>
          <b>{{ '_angularcore.claims.reject-reason' | translate }}</b>
          <p class="multiline">
            {{ node.data.rejectReason.reason }}
          </p>
        </ion-col>
      </ion-row>
    </div>

    <div class="footer">
      <button ion-button icon-left round outline color="danger"
        [title]="'_angularcore.claims.dispatcher.deleteDispatcher.title' | translate"
        [disabled]="computed.loading"
        *ngIf="canDeleteClaim(node.data)"
        (click)="triggerDispatcher(node.data, 'deleteDispatcher', $event)">
        {{ '_angularcore.claims.delete' | translate }}
      </button>
      <button ion-button icon-left round outline color="danger"
        [title]="'_angularcore.claims.dispatcher.rejectDispatcher.title' | translate"
        [disabled]="computed.loading"
        *ngIf="canRejectClaim(node.data)"
        (click)="openRejectClaim(node.data, $event)">
        {{ '_angularcore.claims.reject' | translate }}
      </button>
      <button ion-button icon-left round outline
        [title]="'_angularcore.claims.issue-claim' | translate"
        [disabled]="computed.loading"
        *ngIf="canIssueClaim(node.data)"
        (click)="openIssueClaim(node.data, $event)">
        {{ '_angularcore.claims.issue' | translate }}
      </button>
      <button ion-button icon-left round outline color="success"
        [title]="'_angularcore.claims.dispatcher.acceptDispatcher.title' | translate"
        [disabled]="computed.loading"
        *ngIf="canAcceptClaim(node.data)"
        (click)="triggerDispatcher(node.data, 'acceptDispatcher', $event)">
        {{ '_angularcore.claims.accept' | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!------------------------------------------ detailClaim ------------------------------------------>
<ng-template #claimDetailDisplay let-detailClaim="detailClaim">
  <svg
    [style.height]="d3.dimensions.fullHeight + 'px'"
    (click)="activeDetailHover = null; ref.detectChanges();">
    <g
      [attr.width]="d3.dimensions.width"
      [attr.height]="d3.dimensions.height">
      <g class="tree-container">
        <defs>
          <marker id="arrow-danger" orient="auto" markerWidth="10" markerHeight="10" refX="1" refY="4">
            <path class="arrow danger" d="M0,4 L8,0 L8,8 z"></path>
          </marker>
          <marker id="arrow-warning" orient="auto" markerWidth="10" markerHeight="10" refX="1" refY="4">
            <path class="arrow warning" d="M0,4 L8,0 L8,8 z"></path>
          </marker>
          <marker id="arrow-success" orient="auto" markerWidth="10" markerHeight="10" refX="1" refY="4">
            <path class="arrow success" d="M0,4 L8,0 L8,8 z"></path>
          </marker>
        </defs>
        <svg:path class="link"
          *ngFor="let link of d3.links"
          [attr.d]="link.elbow"
          [class.success]="link.data.status === 1 && link.data.warnings.indexOf('rejected') === -1"
          [class.warning]="link.data.status === 0 && link.data.warnings.indexOf('rejected') === -1"
          [class.danger]="link.data.status === -1 || link.data.warnings.indexOf('rejected') !== -1"
          [attr.marker-start]="link.markerStart">
        </svg:path>
        <g class="node"
          *ngFor="let node of d3.nodes; let i = index"
          [attr.transform]="node.transform">
          <ng-container *ngIf="getClaimsOrParents(node.data).length > 0">
            <circle cx="122" cy="0" r="10"
              [class.active]="node.children"
              (click)="node.toggle($event)">
            </circle>
            <text x="122" y="5" text-anchor="middle" stroke-width="1px"
              (click)="node.toggle($event)">
              {{ node.children ? '<' : '>' }}
            </text>
          </ng-container>
          <foreignObject
            [attr.height]="d3.dimensions.boxHeight + (i === 0 ? 50 : 0)"
            [attr.width]="d3.dimensions.boxWidth - d3.dimensions.connectorDot"
            [attr.x]="-(d3.dimensions.boxWidth / 2)"
            [attr.y]="-(d3.dimensions.boxHeight / 2) - (i === 0 ? 50 : 0)">
            <ng-container *ngIf="i === 0">
              <ng-container
                *ngTemplateOutlet="claimPersonDisplay;context:{ claim: node.data, mode: 'detail' }">
              </ng-container>
            </ng-container>
            <ng-container *ngIf="i !== 0">
              <ng-container
                *ngTemplateOutlet="claimDisplay;context:{ claim: node.data, mode: 'detail', action: node.toggleDetail }">
              </ng-container>
            </ng-container>
          </foreignObject>
        </g>
      </g>

      <foreignObject class="evan-detail-hover"
        height="1000"
        width="500"
        *ngIf="activeDetailHover"
        [attr.transform]="activeDetailHover.hoverTransform"
        [@opacityTransition]>
        <ng-container
          *ngTemplateOutlet="claimDetailHover;context:{ node: activeDetailHover }">
        </ng-container>
      </foreignObject>
    </g>
  </svg>
</ng-template>

<!--------------------------------------- usal component ------------------------------------------>
<ng-container *ngIf="!loading">
  <ng-container *ngIf="mode !== 'detail'">
    <ng-container *ngIf="compute">
      <ng-container
        *ngTemplateOutlet="claimDisplay;context:{ claim: computed, mode: mode }">
      </ng-container>
    </ng-container>
    <ng-container *ngIf="!compute">
      <ng-container *ngFor="let claim of claims">
        <ng-container
          *ngTemplateOutlet="claimDisplay;context:{ claim: claim, mode: mode }">
        </ng-container>
      </ng-container>
    </ng-container>
  </ng-container>

  <div class="evan-detailed-claim" #evanDetailClaim *ngIf="mode === 'detail'">
    <ng-container col-12 col-xl-6 *ngIf="loadingClaims">
      <ng-container 
        *ngTemplateOutlet="claimDisplay;context:{ claim: computed, mode: mode }">
      </ng-container>
    </ng-container>
    <ng-container *ngIf="!loadingClaims">
      <ng-container
        *ngTemplateOutlet="claimDetailDisplay;context:{ detailClaim: computed }">
      </ng-container>
    </ng-container>
  </div>

  <div class="evan-modal evan-claim-modal"
    *ngIf="popupClaim"
    [class.show-modal]="popupClaim.showModal"
    [class.disable-scrolling]="disableScrolling">
    <div class="backdrop" (click)="removeClaimModal(popupClaim, 'popupClaim', $event)"></div>

    <div class="evan-content evan-small-content"
      *ngIf="popupClaim">
      <h3 class="content-header m-b-0 m-t-0">
        {{ '_angularcore.claims.details' | translate }}
      </h3>
      <p ion-text class="m-b-0 m-t-0" *ngIf="!showAddressSelect">
        {{ '_angularcore.claims.details-desc' | translate }}
      </p>

      <ion-row margin-bottom>
        <ion-col margin-top col-12 col-md-6>
          <b>{{ '_angularcore.claims.topic' | translate }}</b>
          <p class="m-b-0 m-t-0">{{ popupClaim.name }}</p>
        </ion-col>
        <ion-col margin-top col-12 col-md-6>
          <b>{{ '_angularcore.claims.subject' | translate }}</b>
          <p class="m-b-0 m-t-0">
            <ng-container *ngIf="popupClaim.subjects">
              <ng-container *ngFor="let subject of popupClaim.subjects; let i = index">
                <span *ngIf="i !== 0">, </span>
                <ng-container *ngTemplateOutlet="userAlias;context:{ address:subject }"></ng-container>
              </ng-container>
            </ng-container>
            <ng-container *ngIf="!popupClaim.subjects">
              <ng-container *ngTemplateOutlet="userAlias;context:{ address:popupClaim.subject }"></ng-container>
            </ng-container>
          </p>
        </ion-col>
      </ion-row>

      <div class="evan-detailed-claim" #evanDetailClaim>
        <ng-container
          *ngTemplateOutlet="claimDetailDisplay;context:{ detailClaim: popupClaim }">
        </ng-container>
      </div>

      <div margin-top text-center>
        <button ion-button icon-left color="medium-gray" round outline
          (click)="removeClaimModal(popupClaim, 'popupClaim', $event)">
          <ion-icon name="close"></ion-icon>
          <span color="light">{{ '_angularcore.claims.close-details' | translate }}</span>
        </button>
      </div>
    </div>
  </div>

  <div class="evan-modal"
    *ngIf="issueClaim"
    [class.show-modal]="issueClaim.showModal"
    [class.disable-scrolling]="disableScrolling">
    <div class="backdrop" (click)="removeClaimModal(issueClaim, 'issueClaim', $event)"></div>

    <div class="evan-content evan-small-content" *ngIf="issueClaim">
      <h2 class="content-header">{{ '_angularcore.claims.issue-claim' | translate }}</h2>

      <span
        [innerHTML]="'_angularcore.claims.issue-claim-description' | translate:{ topic: issueClaim.name, from: getAddressbookName(issueClaim.issuerAccount), to: getAddressbookName(issueClaim.subjects ? issueClaim.subjects[0] : issueClaim.subject) }">
      </span>

      <div class="display-flex-justify">
        <ion-checkbox margin-right
          [(ngModel)]="issueClaim.enableExpirationDate"
          (ionChange)="ref.detectChanges()"
          (focusout)="ref.detectChanges()">
        </ion-checkbox>
        <ion-item>
          <ion-label stacked>
            {{ '_angularcore.claims.expiration-date' | translate }}*
          </ion-label>
          <ion-datetime
            [disabled]="!issueClaim.enableExpirationDate"
            displayFormat="DD-MM-YYYY H:mm"
            pickerFormat="DD-MMM-YYYY HH:mm"
            [(ngModel)]="issueClaim.expirationDate"
            [placeholder]="'_angularcore.claims.expiration-date' | translate"
            [cancelText]="'_angularcore.claims.cancel' | translate"
            [doneText]="'_angularcore.claims.done' | translate"
            minuteValues="0,15,30,45"
            [min]="now"
            [max]="maxDate"
            [monthShortNames]="translate.monthShortNames"
            (ionChange)="ref.detectChanges()"
            (focusout)="ref.detectChanges()">
          </ion-datetime>
        </ion-item>
      </div>

      <div margin-top text-center>
        <button ion-button icon-left color="medium-gray" round outline
          (click)="removeClaimModal(issueClaim, 'issueClaim', $event)">
          <ion-icon name="close"></ion-icon>
          <span color="light">{{ '_angularcore.claims.close-details' | translate }}</span>
        </button>

        <button ion-button outline round icon-left
          [disabled]="computed.loading || (issueClaim.enableExpirationDate ? !issueClaim.expirationDate : false)"
          (click)="triggerDispatcher(issueClaim, 'issueDispatcher')">
          <ion-spinner *ngIf="computed.loading"></ion-spinner>
          {{ '_angularcore.claims.issue-claim' | translate }}
        </button>
      </div>
    </div>
  </div>

  <div class="evan-modal"
    *ngIf="rejectClaim"
    [class.show-modal]="rejectClaim.showModal"
    [class.disable-scrolling]="disableScrolling">
    <div class="backdrop" (click)="removeClaimModal(rejectClaim, 'rejectClaim', $event)"></div>

    <div class="evan-content evan-small-content" *ngIf="rejectClaim">
      <h2 class="content-header">{{ '_angularcore.claims.dispatcher.rejectDispatcher.title' | translate }}</h2>

      <ng-container
        *ngIf="rejectClaim.warnings.indexOf('rejected') === -1">
        <span
          [innerHTML]="'_angularcore.claims.dispatcher.rejectDispatcher.description' | translate:{ topic: rejectClaim.name, from: getAddressbookName(rejectClaim.issuerAccount), to: getAddressbookName(rejectClaim.subjects ? rejectClaim.subjects[0] : rejectClaim.subject) }">
        </span>

        <div class="display-flex-justify">
          <ion-checkbox margin-right
            [(ngModel)]="rejectClaim.enableReason"
            (ionChange)="ref.detectChanges()"
            (focusout)="ref.detectChanges()">
          </ion-checkbox>
          <ion-item>
            <ion-label stacked>
              {{ '_angularcore.claims.reject-reason' | translate }}*
            </ion-label>
            <ion-textarea rows="6"
              [disabled]="!rejectClaim.enableReason"
              [(ngModel)]="rejectClaim.rejectReason.reason"
              (ionChange)="ref.detectChanges()">
            </ion-textarea>
          </ion-item>
        </div>
      </ng-container>

      <ng-container *ngIf="rejectClaim.warnings.indexOf('rejected') !== -1">
        <span
          [innerHTML]="'_angularcore.claims.dispatcher.rejectDispatcher.rejected-description' | translate:{ topic: rejectClaim.name, from: getAddressbookName(rejectClaim.issuerAccount), to: getAddressbookName(rejectClaim.subjects ? rejectClaim.subjects[0] : rejectClaim.subject), rejector: getAddressbookName(rejectClaim.rejectReason.rejector) }">
        </span>
        <b>{{ rejectClaim.rejectReason.date | date:'mediumDate':'':translate.translate.currentLang }}</b>.
        <div class="display-flex-justify">
          <ion-item>
            <ion-label stacked>
              {{ '_angularcore.claims.reject-reason' | translate }}
            </ion-label>
            <ion-textarea rows="6" readonly
              [(ngModel)]="rejectClaim.rejectReason.reason"
              (ionChange)="ref.detectChanges()">
            </ion-textarea>
          </ion-item>
        </div>
      </ng-container>

      <div margin-top text-center *ngIf="rejectClaim.warnings.indexOf('rejected') === -1">
        <button ion-button icon-left color="medium-gray" round outline
          (click)="removeClaimModal(rejectClaim, 'rejectClaim', $event)">
          <ion-icon name="close"></ion-icon>
          <span color="light">{{ '_angularcore.claims.close-details' | translate }}</span>
        </button>

        <button ion-button outline round icon-left
          [disabled]="computed.loading || (rejectClaim.enableReason ? !rejectClaim.rejectReason.reason : false)"
          (click)="triggerDispatcher(rejectClaim, 'rejectDispatcher')">
          <ion-spinner *ngIf="computed.loading"></ion-spinner>
          {{ '_angularcore.claims.reject-claim' | translate }}
        </button>
      </div>
    </div>
  </div>

  <div class="evan-modal claim-dbcp-edit"
    *ngIf="editDBCPClaim"
    [class.show-modal]="editDBCPClaim.showModal"
    [class.disable-scrolling]="disableScrolling">
    <div class="backdrop" (click)="removeClaimModal(editDBCPClaim, 'editDBCPClaim', $event)"></div>

    <div class="evan-content evan-small-content" margin-top *ngIf="editDBCPClaim">
      <h3 class="content-header m-b-0 m-t-0">
        {{ '_angularcore.claims.claim-description' | translate }}: {{ topic }}
      </h3>

      <form no-margin #descForm="ngForm">
        <ion-item>
          <ion-label stacked>
           {{ '_angularcore.claims.descName.title' | translate }}*
          </ion-label>
          <ion-input name="descName" required autofocus
            [(ngModel)]="editDBCPClaim.description.i18n.name.en"
            [placeholder]="'_angularcore.claims.descName.desc' | translate"
            (ionChange)="ref.detectChanges()"
            (focusout)="ref.detectChanges()">
          </ion-input>
        </ion-item>
        <ion-chip class="error-hint" *ngIf="showError(descForm, 'descName')" color="danger">
          <ion-label>{{ '_angularcore.claims.descName.error' | translate }}</ion-label>
        </ion-chip>

        <ion-label class="standalone">
         {{ '_angularcore.claims.select-desc-img.title' | translate }}*
        </ion-label>
        <div text-center class="img-selector">
          <svg *ngIf="!editDBCPClaim.description.imgSquare" version="1.0" xmlns="http://www.w3.org/2000/svg"
            width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000"
            preserveAspectRatio="xMidYMid meet">
              <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" stroke="none">
              <path d="M2510 4994 c-135 -140 -432 -395 -635 -547 -502 -375 -990 -618
              -1444 -719 l-104 -23 7 -107 c14 -233 92 -597 192 -894 311 -930 933 -1793
              1784 -2475 164 -131 188 -149 198 -149 20 0 283 183 420 293 594 475 1057
              1046 1388 1712 233 468 377 929 453 1450 12 77 21 147 21 156 0 11 -34 29
              -112 58 -335 126 -816 354 -1103 522 -374 219 -660 429 -906 667 -59 56 -108
              102 -111 102 -2 0 -24 -21 -48 -46z m143 -406 c392 -340 1056 -731 1682 -988
              72 -30 133 -56 137 -59 9 -7 -39 -250 -82 -421 -141 -556 -410 -1114 -770
              -1595 -149 -199 -270 -337 -474 -540 -200 -200 -320 -306 -491 -434 -144 -108
              -115 -109 -248 2 -422 354 -786 755 -1063 1172 -301 452 -517 931 -632 1405
              -33 135 -74 361 -67 368 2 3 69 26 147 52 466 156 946 432 1439 826 63 51 163
              135 223 188 59 53 109 96 112 96 2 0 41 -32 87 -72z"/>
              <path d="M2555 4460 c-11 -17 -256 -219 -395 -324 -411 -312 -848 -557 -1240
              -697 l-105 -37 2 -45 c2 -66 66 -317 127 -501 258 -773 756 -1489 1469 -2114
              l118 -104 37 28 c209 159 518 451 698 659 421 487 719 1003 908 1577 53 162
              126 451 129 509 l2 41 -110 47 c-609 263 -1145 578 -1582 930 -29 24 -54 37
              -58 31z"/>
            </g>
          </svg>
          <img
            *ngIf="editDBCPClaim.description.imgSquare"
            [src]="_DomSanitizer.bypassSecurityTrustUrl(editDBCPClaim.description.imgSquare)">

          <evan-file-select name="image" #imgFileSelect
            class="img-file-select"
            [(ngModel)]="editDBCPClaim.selectedImages"
            [accept]="'image/x-png,image/gif,image/jpeg'"
            [buttonText]="'_angularcore.claims.select-desc-img.select' | translate"
            [multiple]="false"
            (onChange)="descriptionImgChanged(editDBCPClaim)">
          </evan-file-select>

          <div text-center>
            <button ion-button outline round margin-top icon-left
              (click)="imgFileSelect.selectFiles()">
              {{ '_angularcore.claims.select-desc-img.select' | translate }}
            </button>
          </div>
        </div>
      </form>

      <div text-center margin-top>
        <button ion-button icon-left color="medium-gray" round outline
          (click)="removeClaimModal(editDBCPClaim, 'editDBCPClaim', $event)">
          <ion-icon name="close"></ion-icon>
          <span color="light">{{ '_angularcore.claims.close-details' | translate }}</span>
        </button>

        <button ion-button outline round icon-left
          [disabled]="!editDBCPClaim.description.i18n.name.en || computed.loading"
          (click)="triggerDispatcher(editDBCPClaim, 'descriptionDispatcher', $event)">
          <ion-spinner *ngIf="computed.loading"></ion-spinner>

          {{ '_angularcore.claims.set-description' | translate }}
        </button>
      </div>
    </div>
  </div>
</ng-container>
